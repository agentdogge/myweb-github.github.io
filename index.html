<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Global Social Platforms</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            facebook: '#1877F2',
            instagram: '#C13584',
            youtube: '#FF0000',
            tiktok: '#000000',
            whatsapp: '#25D366',
            website: '#165DFF',
            verification: '#6366F1',
            verified: '#10B981',
            locked: '#EF4444',
            error: '#F87272',
            success: '#10B981',
            warning: '#FBBF24',
          },
          fontFamily: {
            inter: ['Inter', 'sans-serif'],
          },
        },
      }
    }
  </script>
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .card-hover {
        @apply transition-all duration-300 hover:shadow-xl hover:-translate-y-1;
      }
      .btn-facebook {
        @apply bg-facebook text-white px-4 py-2 rounded-lg transition-all hover:bg-facebook/90 active:scale-95;
      }
      .btn-instagram {
        @apply bg-instagram text-white px-4 py-2 rounded-lg transition-all hover:bg-instagram/90 active:scale-95;
      }
      .btn-youtube {
        @apply bg-youtube text-white px-4 py-2 rounded-lg transition-all hover:bg-youtube/90 active:scale-95;
      }
      .btn-tiktok {
        @apply bg-tiktok text-white px-4 py-2 rounded-lg transition-all hover:bg-tiktok/90 active:scale-95;
      }
      .btn-whatsapp {
        @apply bg-whatsapp text-white px-4 py-2 rounded-lg transition-all hover:bg-whatsapp/90 active:scale-95;
      }
      .btn-website {
        @apply bg-website text-white px-4 py-2 rounded-lg transition-all hover:bg-website/90 active:scale-95;
      }
      .btn-verification {
        @apply bg-verification text-white px-6 py-3 rounded-lg transition-all hover:bg-verification/90 active:scale-95 shadow-lg;
      }
      .btn-wake {
        @apply bg-warning text-white px-6 py-3 rounded-lg transition-all hover:bg-warning/90 active:scale-95 shadow-lg;
      }
      .btn-verify {
        @apply bg-verification text-white px-4 py-2 rounded-lg transition-all hover:bg-verification/90 active:scale-95;
      }
      .btn-locked {
        @apply bg-gray-300 text-gray-500 cursor-not-allowed px-6 py-3 rounded-lg shadow-md;
      }
      .verification-code {
        @apply text-[clamp(1.5rem,5vw,2.5rem)] font-bold tracking-widest bg-white p-4 rounded-xl shadow-md border-2;
      }
      .code-unverified {
        @apply text-verification border-verification/30;
      }
      .code-verified {
        @apply text-verified border-verified/30;
      }
      .code-expired {
        @apply text-gray-400 border-gray-200 line-through;
      }
      .code-hidden {
        @apply text-transparent border-gray-200 bg-gray-100;
      }
      .fade-in {
        animation: fadeIn 0.5s ease-in-out;
      }
      @keyframes fadeIn {
        0% { opacity: 0; transform: translateY(10px); }
        100% { opacity: 1; transform: translateY(0); }
      }
      .blink {
        animation: blink 1s infinite;
      }
      @keyframes blink {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
      }
      .shake {
        animation: shake 0.5s;
      }
      @keyframes shake {
        0%, 100% { transform: translateX(0); }
        25% { transform: translateX(-5px); }
        75% { transform: translateX(5px); }
      }
      .countdown-pulse {
        animation: pulse 1s infinite;
      }
      @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.7; }
      }
      .blur-out {
        animation: blurOut 1s forwards;
      }
      @keyframes blurOut {
        0% { filter: blur(0); }
        100% { filter: blur(10px); }
      }
      /* 防止截屏样式 */
      .anti-screenshot {
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        -khtml-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        pointer-events: none;
        position: relative;
      }
      .anti-screenshot::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(255, 255, 255, 0.01);
        pointer-events: none;
      }
    }
  </style>
</head>
<body class="font-inter bg-gray-50 text-gray-800">
  <!-- 引导模态框 -->
  <div id="welcomeModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 fade-in">
    <div class="bg-white rounded-xl shadow-2xl p-6 max-w-md w-full mx-4">
      <div class="text-center mb-6">
        <div class="w-16 h-16 bg-verification/20 rounded-full flex items-center justify-center mx-auto mb-4">
          <i class="fa fa-shield text-2xl text-verification"></i>
        </div>
        <h4 class="text-xl font-bold text-gray-800">Secure Verification Required</h4>
        <p class="text-gray-600 mt-2">
          To ensure the security of your after-sales service, please generate a one-time verification code linked to your device.
        </p>
      </div>
      <div class="flex gap-3">
        <button id="cancelWelcomeBtn" class="flex-1 bg-gray-200 text-gray-700 px-4 py-3 rounded-lg transition-all hover:bg-gray-300 active:scale-95">
          Cancel
        </button>
        <button id="confirmWelcomeBtn" class="flex-1 bg-verification text-white px-4 py-3 rounded-lg transition-all hover:bg-verification/90 active:scale-95">
          <i class="fa fa-key mr-1"></i> Generate Code
        </button>
      </div>
    </div>
  </div>

  <!-- 错误提示模态框 -->
  <div id="errorModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-xl shadow-2xl p-6 max-w-md w-full mx-4 fade-in">
      <div class="text-center mb-6">
        <div class="w-16 h-16 bg-error/20 rounded-full flex items-center justify-center mx-auto mb-4">
          <i class="fa fa-exclamation-circle text-2xl text-error"></i>
        </div>
        <h4 class="text-xl font-bold text-gray-800" id="errorModalTitle">Verification Error</h4>
        <p class="text-gray-600 mt-2" id="errorModalMessage">
          An error occurred during verification. Please try again.
        </p>
      </div>
      <div class="flex justify-center">
        <button id="closeErrorBtn" class="bg-error text-white px-6 py-3 rounded-lg transition-all hover:bg-error/90 active:scale-95">
          Close
        </button>
      </div>
    </div>
  </div>

  <main class="container mx-auto px-4 py-8">
    <!-- 页面标题 -->
    <section class="text-center mb-12">
      <h2 class="text-[clamp(1.8rem,4vw,3rem)] font-bold mb-4 bg-clip-text text-transparent bg-gradient-to-r from-website to-blue-400">
        After-sales Service Card
      </h2>
      <p class="text-gray-600 max-w-2xl mx-auto text-lg">
        You can use this card to quickly find all of our social media accounts
      </p>
    </section>
    
    <!-- 平台网格 -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6" id="socialPlatforms">
      <!-- Facebook -->
      <div class="social-card bg-white rounded-xl shadow-md overflow-hidden card-hover" data-category="Social Networks">
        <div class="h-3 bg-facebook"></div>
        <div class="p-6">
          <div class="flex justify-between items-start mb-4">
            <div class="w-12 h-12 rounded-lg bg-facebook/10 flex items-center justify-center">
              <i class="fa fa-facebook text-facebook text-2xl"></i>
            </div>
            <span class="bg-facebook/10 text-facebook text-xs px-2 py-1 rounded-full">Social Network</span>
          </div>
          <h3 class="text-xl font-bold mb-2">Facebook</h3>
          <p class="text-gray-600 text-sm h-12 mb-4 overflow-hidden">The world's largest social network with over 2.8 billion monthly active users.</p>
          <a href="https://www.facebook.com/xitumaoyiebike/" target="_blank" class="block w-full text-center btn-facebook">
            Find us
          </a>
        </div>
      </div>
      
      <!-- Instagram -->
      <div class="social-card bg-white rounded-xl shadow-md overflow-hidden card-hover" data-category="Media Sharing">
        <div class="h-3 bg-instagram"></div>
        <div class="p-6">
          <div class="flex justify-between items-start mb-4">
            <div class="w-12 h-12 rounded-lg bg-instagram/10 flex items-center justify-center">
              <i class="fa fa-instagram text-instagram text-2xl"></i>
            </div>
            <span class="bg-instagram/10 text-instagram text-xs px-2 py-1 rounded-full">Media Sharing</span>
          </div>
          <h3 class="text-xl font-bold mb-2">Instagram</h3>
          <p class="text-gray-600 text-sm h-12 mb-4 overflow-hidden">A photo and video sharing platform popular among younger audiences.</p>
          <a href="https://www.instagram.com/xitumaoyiebike/" target="_blank" class="block w-full text-center btn-instagram">
            Find us
          </a>
        </div>
      </div>
      
      <!-- YouTube -->
      <div class="social-card bg-white rounded-xl shadow-md overflow-hidden card-hover" data-category="Media Sharing">
        <div class="h-3 bg-youtube"></div>
        <div class="p-6">
          <div class="flex justify-between items-start mb-4">
            <div class="w-12 h-12 rounded-lg bg-youtube/10 flex items-center justify-center">
              <i class="fa fa-youtube-play text-youtube text-2xl"></i>
            </div>
            <span class="bg-youtube/10 text-youtube text-xs px-2 py-1 rounded-full">Media Sharing</span>
          </div>
          <h3 class="text-xl font-bold mb-2">YouTube</h3>
          <p class="text-gray-600 text-sm h-12 mb-4 overflow-hidden">The world's largest video-sharing platform with billions of users.</p>
          <a href="https://www.youtube.com/@Xitumaoyiebike" target="_blank" class="block w-full text-center btn-youtube">
            Find us
          </a>
        </div>
      </div>

      <!-- TikTok -->
      <div class="social-card bg-white rounded-xl shadow-md overflow-hidden card-hover" data-category="Social Networks">
        <div class="h-3 bg-tiktok"></div>
        <div class="p-6">
          <div class="flex justify-between items-start mb-4">
            <div class="w-12 h-12 rounded-lg bg-tiktok/10 flex items-center justify-center">
              <i class="fa fa-music text-tiktok text-2xl"></i>
            </div>
            <span class="bg-tiktok/10 text-tiktok text-xs px-2 py-1 rounded-full">Social Network</span>
          </div>
          <h3 class="text-xl font-bold mb-2">TikTok</h3>
          <p class="text-gray-600 text-sm h-12 mb-4 overflow-hidden">A short - form video sharing social networking service.</p>
          <a href="https://www.tiktok.com/@xitumaoyiebike" target="_blank" class="block w-full text-center btn-tiktok">
            Find us
          </a>
        </div>
      </div>

      <!-- WhatsApp -->
      <div class="social-card bg-white rounded-xl shadow-md overflow-hidden card-hover" data-category="Social Networks">
        <div class="h-3 bg-whatsapp"></div>
        <div class="p-6">
          <div class="flex justify-between items-start mb-4">
            <div class="w-12 h-12 rounded-lg bg-whatsapp/10 flex items-center justify-center">
              <i class="fa fa-whatsapp text-whatsapp text-2xl"></i>
            </div>
            <span class="bg-whatsapp/10 text-whatsapp text-xs px-2 py-1 rounded-full">Social Network</span>
          </div>
          <h3 class="text-xl font-bold mb-2">WhatsApp</h3>
          <p class="text-gray-600 text-sm h-12 mb-4 overflow-hidden">Our Phone Number +1（806）5598952.</p>
          <a href="https://wa.me/your-phone-number" target="_blank" class="block w-full text-center btn-whatsapp">
            Find us
          </a>
        </div>
      </div>

      <!-- 独立站 -->
      <div class="social-card bg-white rounded-xl shadow-md overflow-hidden card-hover" data-category="Independent Website">
        <div class="h-3 bg-website"></div>
        <div class="p-6">
          <div class="flex justify-between items-start mb-4">
            <div class="w-12 h-12 rounded-lg bg-website/10 flex items-center justify-center">
              <i class="fa fa-globe text-website text-2xl"></i>
            </div>
            <span class="bg-website/10 text-website text-xs px-2 py-1 rounded-full">Independent Website</span>
          </div>
          <h3 class="text-xl font-bold mb-2">Independent Website</h3>
          <p class="text-gray-600 text-sm h-12 mb-4 overflow-hidden">https://www.xitumaoyiebike.com.</p>
          <a href="https://www.xitumaoyiebike.com" target="_blank" class="block w-full text-center btn-website">
            Find us
          </a>
        </div>
      </div>
    </div>

    <!-- 验证码生成模块 -->
    <section class="mt-16 text-center">
      <div class="bg-white rounded-2xl shadow-lg p-8 max-w-md mx-auto">
        <h3 class="text-2xl font-bold mb-6 text-gray-800">Verification Code System</h3>
        
        <!-- 生成区域 -->
        <div id="generatorSection">
          <div id="unverifiedState" class="mb-6">
            <p class="text-gray-600 mb-4">Click the button below to generate a 6-digit verification code<br>
            <span class="text-sm text-gray-500">This code will be permanently linked to your device</span></p>
            <div id="verificationCode" class="verification-code code-unverified">------</div>
          </div>
          <div id="verifiedState" class="mb-6 hidden">
            <div class="flex items-center justify-center mb-4">
              <i class="fa fa-check-circle text-2xl text-verified mr-2"></i>
              <p class="text-gray-600">Verification code permanently linked</p>
            </div>
            <div id="verifiedCode" class="verification-code code-hidden anti-screenshot">------</div>
            <p class="text-sm text-gray-600 mt-2">
              <i class="fa fa-eye-slash mr-1"></i> 
              <span>The verification code is hidden to prevent unauthorized access</span>
            </p>
            <button id="wakeCodeBtn" class="btn-wake mt-4">
              <i class="fa fa-eye mr-2"></i> Wake Up Code
            </button>
          </div>
          <button id="generateBtn" class="btn-verification">
            <i class="fa fa-refresh mr-2"></i> Generate Code
          </button>
          <div id="lockedInfo" class="mt-4 text-sm text-locked hidden">
            <i class="fa fa-lock mr-1"></i> <span>This code cannot be changed once generated</span>
          </div>
        </div>
        
        <!-- 唤醒确认弹窗 -->
        <div id="wakeConfirmationModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
          <div class="bg-white rounded-xl shadow-2xl p-6 max-w-md w-full mx-4 fade-in">
            <div class="text-center mb-6">
              <div class="w-16 h-16 bg-warning/20 rounded-full flex items-center justify-center mx-auto mb-4">
                <i class="fa fa-exclamation-triangle text-2xl text-warning"></i>
              </div>
              <h4 class="text-xl font-bold text-gray-800">Confirm to Wake Up Code</h4>
              <p class="text-gray-600 mt-2">
                Once the verification code is revealed, it will expire permanently after 1 minute.
                <br><span class="text-sm text-gray-500">You will not be able to generate a new code after expiration.</span>
              </p>
            </div>
            <div class="flex gap-3">
              <button id="cancelWakeBtn" class="flex-1 bg-gray-200 text-gray-700 px-4 py-3 rounded-lg transition-all hover:bg-gray-300 active:scale-95">
                Cancel
              </button>
              <button id="confirmWakeBtn" class="flex-1 bg-warning text-white px-4 py-3 rounded-lg transition-all hover:bg-warning/90 active:scale-95">
                <i class="fa fa-eye mr-1"></i> Reveal Code
              </button>
            </div>
          </div>
        </div>
        
        <!-- 倒计时显示 -->
        <div id="countdownSection" class="mt-6 hidden">
          <div class="bg-gray-50 rounded-lg p-4">
            <div class="flex items-center justify-center">
              <i class="fa fa-clock-o text-warning text-xl mr-2"></i>
              <span id="countdownTimer" class="text-lg font-medium text-gray-800">01:00</span>
            </div>
            <p class="text-sm text-gray-500 mt-1 text-center">The code will expire after this time</p>
          </div>
        </div>
        
        <!-- 验证后状态 -->
        <div id="postVerificationSection" class="hidden">
          <div id="verificationSuccess" class="hidden">
            <div class="p-4 bg-success/10 rounded-lg border border-success/30">
              <div class="flex items-center">
                <i class="fa fa-check-circle text-2xl text-success mr-3"></i>
                <div class="text-left">
                  <h4 class="font-bold text-success">Verification Successful</h4>
                  <p class="text-sm text-gray-600">The code has been permanently invalidated</p>
                </div>
              </div>
            </div>
          </div>
          <div id="verificationFailed" class="hidden">
            <div class="p-4 bg-error/10 rounded-lg border border-error/30">
              <div class="flex items-center">
                <i class="fa fa-times-circle text-2xl text-error mr-3"></i>
                <div class="text-left">
                  <h4 class="font-bold text-error">Verification Failed</h4>
                  <p class="text-sm text-gray-600" id="errorMessage">The code you entered is incorrect</p>
                </div>
              </div>
            </div>
          </div>
          <div id="codeExpired" class="hidden">
            <div class="p-4 bg-gray-50 rounded-lg border border-gray-200">
              <div class="flex items-center">
                <i class="fa fa-hourglass-end text-gray-400 text-2xl mr-3"></i>
                <div class="text-left">
                  <h4 class="font-bold text-gray-700">Code Expired</h4>
                  <p class="text-sm text-gray-500">The verification code has expired after 1 minute</p>
                </div>
              </div>
            </div>
          </div>
          <div id="deviceMismatch" class="hidden">
            <div class="p-4 bg-error/10 rounded-lg border border-error/30">
              <div class="flex items-center">
                <i class="fa fa-exclamation-circle text-2xl text-error mr-3"></i>
                <div class="text-left">
                  <h4 class="font-bold text-error">Device Mismatch</h4>
                  <p class="text-sm text-gray-600">
                    This verification code is linked to a different device.
                    <br>One-time codes cannot be transferred between devices.
                  </p>
                </div>
              </div>
            </div>
          </div>
          <div id="codePermanentlyLocked" class="hidden">
            <div class="p-4 bg-error/10 rounded-lg border border-error/30">
              <div class="flex items-center">
                <i class="fa fa-lock text-2xl text-error mr-3"></i>
                <div class="text-left">
                  <h4 class="font-bold text-error">Code Permanently Locked</h4>
                  <p class="text-sm text-gray-600">
                    A verification code has already been generated for this device.
                    <br>One-time codes cannot be regenerated.
                  </p>
                </div>
              </div>
            </div>
          </div>
          <div class="mt-6">
            <div id="finalCodeDisplay" class="verification-code code-expired blur-out">------</div>
            <p class="text-sm text-gray-500 mt-2">This code has expired and cannot be used</p>
          </div>
          <button id="newCodeBtn" class="btn-verification mt-6" disabled>
            <i class="fa fa-plus mr-2"></i> Generate New Code
          </button>
          <p class="text-xs text-gray-400 mt-3">
            <i class="fa fa-info-circle mr-1"></i> Code generation is permanently disabled after first use
          </p>
        </div>
      </div>
    </section>
  </main>

  <script>
    // 验证码生成功能
    document.addEventListener('DOMContentLoaded', () => {
      // DOM元素
      const generateBtn = document.getElementById('generateBtn');
      const verificationCode = document.getElementById('verificationCode');
      const verifiedCode = document.getElementById('verifiedCode');
      const unverifiedState = document.getElementById('unverifiedState');
      const verifiedState = document.getElementById('verifiedState');
      const lockedInfo = document.getElementById('lockedInfo');
      const wakeCodeBtn = document.getElementById('wakeCodeBtn');
      const wakeConfirmationModal = document.getElementById('wakeConfirmationModal');
      const cancelWakeBtn = document.getElementById('cancelWakeBtn');
      const confirmWakeBtn = document.getElementById('confirmWakeBtn');
      const countdownSection = document.getElementById('countdownSection');
      const countdownTimer = document.getElementById('countdownTimer');
      const generatorSection = document.getElementById('generatorSection');
      const postVerificationSection = document.getElementById('postVerificationSection');
      const verificationSuccess = document.getElementById('verificationSuccess');
      const verificationFailed = document.getElementById('verificationFailed');
      const errorMessage = document.getElementById('errorMessage');
      const codeExpired = document.getElementById('codeExpired');
      const newCodeBtn = document.getElementById('newCodeBtn');
      const welcomeModal = document.getElementById('welcomeModal');
      const confirmWelcomeBtn = document.getElementById('confirmWelcomeBtn');
      const cancelWelcomeBtn = document.getElementById('cancelWelcomeBtn');
      const errorModal = document.getElementById('errorModal');
      const errorModalTitle = document.getElementById('errorModalTitle');
      const errorModalMessage = document.getElementById('errorModalMessage');
      const closeErrorBtn = document.getElementById('closeErrorBtn');
      const deviceMismatch = document.getElementById('deviceMismatch');
      const codePermanentlyLocked = document.getElementById('codePermanentlyLocked');
      const finalCodeDisplay = document.getElementById('finalCodeDisplay');
      
      // 生成唯一设备ID（增强版，使用多种浏览器指纹信息）
      function generateDeviceId() {
        // 收集多种浏览器特征
        const navigatorInfo = [
          navigator.userAgent,
          navigator.platform,
          navigator.language,
          navigator.hardwareConcurrency,
          window.screen.width,
          window.screen.height,
          window.devicePixelRatio,
          window.screen.colorDepth,
          new Date().getTimezoneOffset(),
          localStorage.getItem('nfcDeviceSalt') || Math.random().toString(36).substring(2)
        ];
        
        // 使用简单的哈希算法生成ID
        let hash = 0;
        for (let i = 0; i < navigatorInfo.length; i++) {
          const value = navigatorInfo[i] || '';
          for (let j = 0; j < value.length; j++) {
            const char = value.charCodeAt(j);
            hash = ((hash << 5) - hash) + char;
            hash |= 0; // Convert to 32bit integer
          }
        }
        
        // 添加时间戳使ID更唯一
        return Math.abs(hash).toString(36) + Date.now().toString(36);
      }
      
      // 获取或生成设备ID
      function getDeviceId() {
        let deviceId = localStorage.getItem('nfcDeviceId');
        if (!deviceId) {
          // 首次生成设备ID时添加随机盐值
          if (!localStorage.getItem('nfcDeviceSalt')) {
            localStorage.setItem('nfcDeviceSalt', Math.random().toString(36).substring(2, 15));
          }
          
          deviceId = generateDeviceId();
          localStorage.setItem('nfcDeviceId', deviceId);
        }
        return deviceId;
      }
      
      // 检查是否已有绑定的验证码或永久锁定标识
      const deviceId = getDeviceId();
      const storedCode = localStorage.getItem('nfcVerificationCode');
      const storedDeviceId = localStorage.getItem('nfcLinkedDeviceId');
      const codeVerified = localStorage.getItem('nfcCodeVerified') === 'true';
      const codeRevealed = localStorage.getItem('nfcCodeRevealed') === 'true';
      const codeExpirationTime = localStorage.getItem('nfcCodeExpirationTime');
      const codeExpiredFlag = localStorage.getItem('nfcCodeExpired') === 'true';
      const codePermanentlyGenerated = localStorage.getItem('nfcCodePermanentlyGenerated') === 'true';
      
      // 检查是否存在永久锁定标识
      if (codePermanentlyGenerated) {
        // 无论设备是否匹配，都禁止生成新验证码
        generatorSection.classList.add('hidden');
        postVerificationSection.classList.remove('hidden');
        codePermanentlyLocked.classList.remove('hidden');
        
        // 如果有存储的验证码，显示已过期的验证码
        if (storedCode) {
          finalCodeDisplay.textContent = storedCode;
        }
        
        return;
      }
      
      // 检测设备变更
      if (storedCode && storedDeviceId && storedDeviceId !== deviceId) {
        // 设备不匹配，显示错误
        generatorSection.classList.add('hidden');
        postVerificationSection.classList.remove('hidden');
        deviceMismatch.classList.remove('hidden');
        if (storedCode) {
          finalCodeDisplay.textContent = storedCode;
        }
        return;
      }
      
      // 如果已有验证码或已验证，不显示引导模态框
      if (!storedCode || !storedDeviceId || !deviceId || deviceId !== storedDeviceId) {
        welcomeModal.classList.remove('hidden');
      }
      
      // 处理引导模态框
      confirmWelcomeBtn.addEventListener('click', () => {
        welcomeModal.classList.add('hidden');
      });
      
      cancelWelcomeBtn.addEventListener('click', () => {
        welcomeModal.classList.add('hidden');
        // 回到主页面（这里只是隐藏模态框，实际应用中可能需要重定向）
      });
      
      // 处理错误模态框
      closeErrorBtn.addEventListener('click', () => {
        errorModal.classList.add('hidden');
      });
      
      // 如果已有绑定的验证码但未验证，直接显示
      if (codeVerified) {
        // 验证码已验证，显示成功状态
        generatorSection.classList.add('hidden');
        postVerificationSection.classList.remove('hidden');
        verificationSuccess.classList.remove('hidden');
        finalCodeDisplay.textContent = storedCode || '------';
      } else if (codeRevealed && codeExpirationTime && Date.now() > parseInt(codeExpirationTime)) {
        // 验证码已显示且已过期
        generatorSection.classList.add('hidden');
        postVerificationSection.classList.remove('hidden');
        codeExpired.classList.remove('hidden');
        newCodeBtn.disabled = true;
        newCodeBtn.classList.add('bg-gray-300', 'text-gray-500', 'cursor-not-allowed');
        newCodeBtn.classList.remove('bg-verification', 'hover:bg-verification/90', 'active:scale-95');
        finalCodeDisplay.textContent = storedCode || '------';
      } else if (storedCode && storedDeviceId === deviceId) {
        // 已有绑定的验证码但未验证
        verifiedCode.textContent = storedCode;
        unverifiedState.classList.add('hidden');
        verifiedState.classList.remove('hidden');
        generateBtn.classList.remove('btn-verification');
        generateBtn.classList.add('btn-locked');
        generateBtn.disabled = true;
        lockedInfo.classList.remove('hidden');
        
        if (codeRevealed && codeExpirationTime) {
          // 已显示，启动倒计时
          startCountdown(parseInt(codeExpirationTime));
        }
      }
      
      // 生成新验证码
      generateBtn.addEventListener('click', () => {
        // 再次检查是否已有永久锁定标识
        if (localStorage.getItem('nfcCodePermanentlyGenerated') === 'true') {
          generatorSection.classList.add('hidden');
          postVerificationSection.classList.remove('hidden');
          codePermanentlyLocked.classList.remove('hidden');
          return;
        }
        
        if (storedCode && storedDeviceId === deviceId) {
          return;
        }
        
        // 生成6位随机数字
        const code = Math.floor(100000 + Math.random() * 900000);
        
        // 添加淡入动画效果
        verificationCode.classList.remove('fade-in');
        void verificationCode.offsetWidth; // 重置动画
        verificationCode.classList.add('fade-in');
        
        // 显示验证码
        verificationCode.textContent = code;
        
        // 绑定到设备
        localStorage.setItem('nfcVerificationCode', code);
        localStorage.setItem('nfcLinkedDeviceId', deviceId);
        localStorage.removeItem('nfcCodeVerified');
        localStorage.removeItem('nfcCodeRevealed');
        localStorage.removeItem('nfcCodeExpirationTime');
        localStorage.removeItem('nfcCodeExpired');
        
        // 添加永久锁定标识
        localStorage.setItem('nfcCodePermanentlyGenerated', 'true');
        
        // 更新UI状态
        setTimeout(() => {
          verifiedCode.textContent = code;
          unverifiedState.classList.add('hidden');
          verifiedState.classList.remove('hidden');
          generateBtn.classList.remove('btn-verification');
          generateBtn.classList.add('btn-locked');
          generateBtn.disabled = true;
          lockedInfo.classList.remove('hidden');
        }, 1000);
        
        // 按钮点击效果
        generateBtn.classList.add('scale-95');
        setTimeout(() => {
          generateBtn.classList.remove('scale-95');
        }, 200);
      });
      
      // 唤醒验证码按钮
      wakeCodeBtn.addEventListener('click', () => {
        wakeConfirmationModal.classList.remove('hidden');
      });
      
      // 取消唤醒
      cancelWakeBtn.addEventListener('click', () => {
        wakeConfirmationModal.classList.add('hidden');
      });
      
      // 确认唤醒
      confirmWakeBtn.addEventListener('click', () => {
        wakeConfirmationModal.classList.add('hidden');
        
        // 显示验证码
        verifiedCode.classList.remove('code-hidden', 'anti-screenshot');
        verifiedCode.classList.add('code-verified');
        
        // 记录显示状态和过期时间
        const expirationTime = Date.now() + 60 * 1000; // 1分钟后过期
        localStorage.setItem('nfcCodeRevealed', 'true');
        localStorage.setItem('nfcCodeExpirationTime', expirationTime);
        
        // 隐藏唤醒按钮，显示倒计时
        wakeCodeBtn.classList.add('hidden');
        countdownSection.classList.remove('hidden');
        
        // 启动倒计时
        startCountdown(expirationTime);
      });
      
      // 启动倒计时
      function startCountdown(expirationTime) {
        countdownSection.classList.remove('hidden');
        
        const updateCountdown = () => {
          const now = Date.now();
          const remainingTime = expirationTime - now;
          
          if (remainingTime <= 0) {
            // 验证码过期
            clearInterval(countdownInterval);
            handleCodeExpiration();
            return;
          }
          
          const seconds = Math.floor(remainingTime / 1000);
          const minutes = Math.floor(seconds / 60);
          const secs = seconds % 60;
          
          countdownTimer.textContent = `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
          
          // 最后10秒添加脉冲动画
          if (seconds <= 10) {
            countdownTimer.classList.add('countdown-pulse');
          }
        };
        
        // 立即更新一次
        updateCountdown();
        
        // 每秒更新一次
        const countdownInterval = setInterval(updateCountdown, 1000);
      }
      
      // 处理验证码过期
      function handleCodeExpiration() {
        // 更新UI状态
        verifiedState.classList.add('hidden');
        countdownSection.classList.add('hidden');
        postVerificationSection.classList.remove('hidden');
        codeExpired.classList.remove('hidden');
        
        // 禁用生成新验证码按钮
        newCodeBtn.disabled = true;
        newCodeBtn.classList.add('bg-gray-300', 'text-gray-500', 'cursor-not-allowed');
        newCodeBtn.classList.remove('bg-verification', 'hover:bg-verification/90', 'active:scale-95');
        
        // 模糊显示验证码
        verifiedCode.classList.add('blur-out', 'code-expired');
        verifiedCode.classList.remove('code-verified');
        finalCodeDisplay.textContent = verifiedCode.textContent;
        
        // 记录验证码已过期
        localStorage.setItem('nfcCodeExpired', 'true');
      }
      
      // 防止刷新重置状态
      window.addEventListener('beforeunload', () => {
        // 如果验证码已显示但未过期，确保刷新后继续倒计时
        if (codeRevealed && codeExpirationTime && Date.now() < parseInt(codeExpirationTime)) {
          localStorage.setItem('nfcCodeRevealed', 'true');
          localStorage.setItem('nfcCodeExpirationTime', codeExpirationTime);
        }
      });
      
      // 检测存储变化（用于多标签页同步）
      window.addEventListener('storage', (e) => {
        if (e.key === 'nfcCodeExpirationTime' || e.key === 'nfcCodeRevealed' || e.key === 'nfcCodePermanentlyGenerated') {
          location.reload(); // 刷新页面以同步状态
        }
      });
    });
  </script>
</body>
</html>  
